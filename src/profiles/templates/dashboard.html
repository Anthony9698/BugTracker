{% extends 'base.html' %}
{% load static %}
{% load dashboard_extras %}

{% block navbar %}
    {% include 'navbar.html' %}
{% endblock %}


{% block content %}
<div class="top-heading">
  <h1>My Dashboard</h1>
</div>

<div class="dashboard-center-content top-heading">
    <h2>Recently updated tickets</h2>
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th>Title</th>
                <th>Updated/Created</th>
                <th>Project</th>
                <th>Priority</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in user_tickets %}
            <tr>
                <td><a href="{% url 'ticket_detail' ticket.id %}">{{ticket.title}}</a></td>
                <td>{{ticket.last_modified_date}}</td>
                <td>{{ticket.project_id}}</td>
                <td>
                    {% if ticket.priority == 'Low' %}
                        <div id="priority_label" style="background-color: rgb(61, 84, 107);">
                            {{ticket.priority}}
                        </div>
                    {% elif ticket.priority == 'Medium' %}
                        <div id="priority_label" style="    background-color: rgb(193, 118, 23);">
                            {{ticket.priority}}
                        </div>
                    {% elif ticket.priority == 'High' %}
                        <div id="priority_label" style="background-color: rgba(255, 68, 0, 0.678);">
                            {{ticket.priority}}
                        </div>
                    {% elif ticket.priority == 'Critical' %}
                        <div id="priority_label" style="background-color: rgb(186, 21, 18);">
                            {{ticket.priority}}
                        </div>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <a class="btn btn-link" href="{% url 'tickets' %}" style="padding-left: 0px;">View all tickets</a>
    <h2> Projects</h2> 
    <div class="emulated-flex-gap">
        {% for project in user_projects %}
            <figure>
                <a href="{% url 'project_detail' project.id %}">
                    <img id="project_img" src="{% static 'images/folder.png' %}" alt="project">
                </a>
                <div style="margin-left: 15px; color: white;">
                    <figcaption><b><a href="{% url 'project_detail' project.id %}">{{project.title}}</a></b></figcaption>
                    <figcaption><b>Tickets: </b>{{project_tickets_dict|keyvalue:project.id}}</figcaption>
                    <figcaption><b>Critical: </b>{{critical_tickets_dict|keyvalue:project.id}}</figcaption>
                    <figcaption><b>Resolved: </b>{{resolved_tickets_dict|keyvalue:project.id}}</figcaption>
                </div>
            </figure>
        {% endfor %}

    </div>
     
    <a class="btn btn-link" href="{% url 'projects' %}" style="padding-left: 0px;">View project list</a>
</div>
{% endblock %}
